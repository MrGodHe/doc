# 背景

![](E:\project\study-doc\doc\image\os\osFileRead.gif)

​	应用程序要读取某个文件时，并不是直接去读取文件，而是通过调用内核程序（也称 system call），内核读取文件后，再返回给应用程序。很明显同一块文件数据，在内存中保留了两份，占据了不必要的内存空间。

针对此问题，操作系统提供了内存映射机制：

- **Linux系统  mmap**
- **windows系统 Filemapping**



# linux 的mmap内存映射原理

​	mmap是一种内存映射方法，将一个文件或者其它对象映射到进程的地址空间，实现文件磁盘地址和进程虚拟地址空间中一段虚拟地址一一对应的关系。实现这样的映射关系后，进程就可以采用指针的方式读写操作这一段内存，而系统会自动回写脏页面到对应的文件磁盘上，即完成了对文件的操作而不必再调用read, write等系统调用函数。相反，内核空间对这段区域的修改也直接反映用户空间，从而可以实现不同进程间的文件共享。

![](E:\project\study-doc\doc\image\os\file-mmap.png)

