

## 内存分析工具

切换到 JDK_HOME/bin/，执行以下命令：./jmap -dump:format=b,file=heap.hprof pid

内存分析工具：

eclipse Memory Analyzer (MAT)



## G1垃圾回收器

![](../../image/java/JVM/jvm004.jpg.jpg)

G1将堆划分为2048个左右的Region内存块，每个Region大小在1-32MB之间，具体多大取决于堆的大小。G1除了普通收集器的Eden，Survivor，Old区外还额外加了Humongous这个区域，Humongous的作用是存放大对象（大对象的判断方式是大于Region的50%），Humongous跟随老年代Full GC清理。

在一个region中可能会引入到其他的region，为了避免不需要的全局扫描，在每个region中都对应一个Remembered Set（记忆集），使用CarTable记录每个region区相互引用的关系。维护解决多个区间引用关系记录，避免扫描所有的区间。 

　　

### G1收集器回收过程：

　　1）年轻代GC（Young GC ）
　　　　当所有eden区满的情况下，采用并行多线程的方式，使用标记复制算法，基于stw暂定所有用户线程，将存活对象复制到S区，清空所有eden区；当S区对象的年龄达到阈值，使用标记复制算法，将对象移动到老年代。

　　2）混合回收（Mixed GC ）
　　　　越来越多的对象晋升到老年代，当堆内存使用达到一定值（（-XX:InitiatingHeapOccupancyPercent 默认45%）时，开始老年代并发标记过程，标记完成马上开始混合回收过程。为了避免堆内存耗尽，会触发混合收集器，即Mixed GC。

        young gc（新生代） 一> young gc + concurrent mark（新生代+并发标记） 一> Mixed GC（混合回收）顺序，进行垃圾回收
